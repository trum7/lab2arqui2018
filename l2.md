<p align="center">
  <img src="./images/UN.png" width="200">
</p>
<h2 align="center"><small>Laboratory #2</small></br> <big>Distributed Architectures, Part 2</big></h2>

<h5 align="center">Jeisson Andrés Vergara Vargas</br><small>Software Architecture</br>2018-I</small></h5>

---

# Pre-requisitos:
Para la realización de este laboratorio es necesario tener los microservicios del caso de estudio realizados en el laboratorio #1, los cuales son:
- Students: sa_students_ms, puerto 3000.
- Courses: courses-ms, puerto 4040.

- Grades: grades-ms, puerto 5000
  * student_id: Integer
  * course_id: Integer
  * grade: float


# Creación del API Gateway

1. Dirigirse a la carpeta donde se creará el API Gateway, e ingresar el comando:

> ` rails new sa_api_gateway --api `

2. Agregar las siguientes líneas en el Gemfile:

> ` gem 'httparty' `  
> ` gem 'rack-cors' `   
> ` gem 'graphql' `
> ` gem 'graphiql-rails' `

3. Ejecutar el siguiente comando en la raíz del proyecto:

> ` gem install httparty `


4. Con el fin de instalar las gemas del proyecto, ejecutar el siguiente comando en la raíz del proyecto:

>  `bundle install `

5. Ejecutar el siguiente comando en la raíz del proyecto:

> ` rails generate graphql:install `

6. Modificar el archivo config/initializers/cors.rb (descomentar las líneas respectivas):

![alt text](./images/image1.png "Logo Title Text 1")

# Dockerización del API Gateway

7. Crear los archivos Dockerfile, y docker-compose.yml. Desplegar el API Gateway en el puerto 6000 (recordar que este componente no hace uso de una base de datos):

* Dockerfile


      FROM ruby:2.3 `  
      RUN mkdir /sa_api_gateway_ms 
      WORKDIR /sa_api_gateway_ms 
      ADD Gemfile /sa_api_gateway_ms/Gemfile`   
      ADD Gemfile.lock /sa_api_gateway_ms/Gemfile.lock   
      RUN bundle install   
      ADD . /sa_api_gateway_ms 

* docker-compose.yml

      version: '2'
      services:
        sa_api_gateway_ms:
          build: .
          command: bash -c "sleep 40 && rm -f tmp/pids/server.pid && bundle exec rails db:migrate && bundle exec rails s -p 6000 -b '0.0.0.0'"
          ports:
            - "6000:6000"


# Graphql

8. Agregar las siguientes lineas al archivos de config/routes.rb 

        post '/gradesbystudent', to: 'graphql#query'
        if Rails.env.development?
          mount GraphiQL::Rails::Engine, at: "/gradesbystudent", graphql_path: "/graphql"
        end